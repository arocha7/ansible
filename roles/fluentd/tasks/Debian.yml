- name: install Treasure Data agent (td-agent)
  shell: "curl -L http://toolbelt.treasuredata.com/sh/install-ubuntu-xenial-td-agent2.sh -o install-td-agent.sh && sh install-td-agent.sh"

- name: start 'td-agent'
  systemd: 
    name: "td-agent"
    state: started

- name: install Elasticsearch plugin for Fluentd
  shell: td-agent-gem install fluent-plugin-elasticsearch
  become: true

- name: set Fluentd configuration to target machine
  copy:
    #src: "{{ lookup('env','PWD') }}/roles/fluentd/files/td-agent.conf"
    src: "td-agent.conf"
    dest: "/etc/td-agent/td-agent.conf"

- name: start 'td-agent'
  systemd: 
    name: "td-agent"
    state: restarted

#
## required to run Docker containers locally 
#
- name: "Docker SDK for Python: docker (Python >= 2.7) or docker-py (Python 2.6)"
  pip:
    name: docker
    state: present
