---
# tasks file for SYSREPO

# Ccache

- name: install Ccache - a compiler cache that speeds up recompilation by caching previous compilations and detecting when the same compilation is being done again
  yum:
    name: [ 'ccache' ]
    state: present

- name: enable Ccache
  shell: '#!/bin/bash && declare -x PATH="/usr/lib64/ccache:$PATH"'

###
# libRedBlack
### 

- name: fetch, build and install libredblack
  git:
    repo: https://github.com/sysrepo/libredblack.git
    dest: /tmp/libredblack
    force: yes
- name: config 'libredblack'
  shell: cd /tmp/libredblack && ./configure
- name: make 'libredblack'
  shell: cd /tmp/libredblack && make
- name: install 'libredblack'
  shell: cd /tmp/libredblack && make install


###
# [CMake](https://cmake.org/install/)
###

#- name: get CMAKE tarball
#  get_url:
#    url: https://github.com/Kitware/CMake/releases/download/v3.16.5/cmake-3.16.5.tar.gz
#    dest: /tmp

#- name: unarchive CMAKE tarball
#  unarchive:
#    src: /tmp/cmake-3.16.5.tar.gz
#    dest: /tmp
#    remote_src: yes

#- name: configure CMAKE and generate 'make'
#  shell: cd /tmp/cmake-3.16.5 && ./bootstrap

#- name: compile CMAKE
#  shell: cd /tmp/cmake-3.16.5 && make

#- name: install CMAKE
#  shell: cd /tmp/cmake-3.16.5 && make install

###
# 'libyang' is YANG data modelling language parser and toolkit written (and providing API) in C - requirement: 'libpcre'
###

- name: get LIBYANG tarball
  get_url:
    url: https://github.com/CESNET/libyang/archive/v1.0.130.tar.gz
    dest: /tmp

- name: unarchive LIBYANG tarball
  unarchive:
    src: /tmp/v1.0.130.tar.gz
    dest: /tmp
    remote_src: yes

- name: configure LIBYANG and generate 'make'
  shell: cd /tmp/libyang-1.0.130 && mkdir -p build && cd build && cmake .. 
  #
  # ```cmake -DPCRE_LIBRARY=/usr/lib64/lipcre.so -DPCRE_INCLUDE_DIR=/usr/include ..```
  #

- name: compile LIBYANG
  shell: cd /tmp/libyang-1.0.130/build && make

- name: install LIBYANG
  shell: cd /tmp/libyang-1.0.130/build && make install


